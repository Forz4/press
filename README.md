# PRESS

一款基于TCP单工异步长连接的压力测试工具

[TOC]

## 特点

1. 组包配置灵活
2. TPS和发送时间实时调整
3. 支持外卡模式
4. 支持短链接模式
5. 支持针对固定格式和8583报文的实时监控，包括响应时间和TPS

## 编译

### linux

cd src && make clean all

### aix

需修改makefile中的CCFLAG和CC变量

## 配置

### 组包配置

#### cfg/pack.cfg

组包配置文件

通过load命令进行加载，也可以自定义配置文件名，通过**load 文件名**方式加载。

    #   组包进程配置文件
    #   组包进程以模板文件中的报文为基础，依据替换规则进行替换后发送
    #   单个组包进程的最大TPS受到机器性能的影响
    #   
    #   第1域 :  模板文件(路径前缀为$PRESS_HOME/data/tpl)
    #   第2域 :  替换规则文件(路径前缀为$PRESS_HOME/data/rule)
    #   第3域 :  初始TPS
    #   第4域 :  发送时长
    [1000.tpl][1000.rule][1000][100]

#### data/tpl/*.tpl

报文模板文件

对应组包配置文件cfg/pack.cfg中的第1域，文件仅包含1行，报文格式为**“4位长度+报文体"**，以下为一个合法的报文模板。

```
0020abcdefghijklmnopqrst
```

#### data/rule/*.rule

替换规则文件

对应组包配置文件cfg/pack.cfg中的第2域，规定了报文域替换方式，以下是一个合法的替换规则举例:

```
# 替换规则文件
# 第1域 :    起始位置
# 第2域 :    替换长度
# 第3域 :    补位方式 
#               1 左补0
#               2 右补空格
# 第4域 :    替换种类
#               1. FILE:文件名    使用对应文件内容替换
#               2. RAND          使用随机数替换
#               3. F7            填充8583报文的7域，格式为MMDDhhmmss，0502182425          
# 从第一位开始替换2字节长度，使用1000.rep文件内容进行替换
[1][2][1][FILE:1000.rep]
# 从第三位开始替换3字节长度，使用随机数替换
[3][3][1][RAND]
# 从第7位开始替换10字节长度，按照7域MMDDhhmmss格式替换
#[7][10][1][F7]
```

#### data/rep/*.rep

域替换文件

对应替换规则文件data/rule/*.rule中的第四域中的文件名，表示将用rep文件的内容逐行替换模板报文对应的域。

### 通讯配置

通讯配置文件为${PRESS_HOME}/cfg/conn.cfg，通过init命令进行加载和启动。

    cfg/conn.cfg
    #   通讯进程配置文件
    #   每一行表示一个通讯进程
    #   第1域: 进程类型 
    #          S: 通讯发送进程
    #          R: 通讯接收进程
    #          J: 外卡通讯进程
    #          X: 短链接通讯进程
    #   第2域: IP地址
    #   第3域: 端口
    #   第4域: 持久化开关
    #          1: 打开报文持久化
    #          0: 关闭报文持久化
    #   第5域: 短链接并发数(默人为1)
    #   第6域: 心跳包间隔(默认为0)
    #   第7域: 持久化编码(默认为H)
    #          H : 十六进制
    #          A : Ascii码
    #   第8域: 监控MONITOR开关,需结合redis试用
    [S][127.0.0.1][4566][1][][][][1]
    [S][127.0.0.1][4567][1][][][][1]
    [S][127.0.0.1][4568][1][][][][1]
    [S][127.0.0.1][4569][1][][][][1]
    [R][127.0.0.1][4566][1][][][][1]
    [R][127.0.0.1][4567][1][][][][1]
    [R][127.0.0.1][4568][1][][][][1]
    [R][127.0.0.1][4570][1][][][][1]
    [J][127.0.0.1][4571][1][][][]
    [X][127.0.0.1][4572][1][5][][]

## 运行

    1. 修改env/press.env中PRESS_HOME环境变量值为当前press工具的安装目录
    2. 执行`. press.env`加载环境变量
    3. 执行`press [-p port] [-l loglevel] [-h]`启动主控，默认端口为6043，默认日志级别为4
    4. 执行`presscmd [-n ip:port]`启动控制台，控制台可以通过多个-n连接多个press主控，默认为127.0.0.1:6043
    5. 执行`press_report snapname1 snapname2 tran,...`可产出测试报告。

